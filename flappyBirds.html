<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlapJack</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        html, body {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            /* outline: 1px solid red; */
            font-family: 'Press Start 2P', sans-serif;
        }
        header{
            width: 100%;
            text-align: center;
            font-size: 2em
        }
    </style>
</head>
<body>
    <div id="header">
        <div id="title">FlapJack</div>
    </div>
    <canvas id="canvas" width="431" height="768"></canvas>

    <script>
       // function setup() {}
       const birdWidth = 51;
       const birdHeight =36;
       const birdStartX = 50;
       const pipeWidth = 78;
       const pipeHeight = 480;
       const pipeGap = birdHeight * 3;
       const pipeYOffset = 200;

       const gravity = 3;
       const antiGravity = 3;
       const flapHeight = 55;
       const flapDuration = 10;

       const pipeSpeed = 2;

       let flapCount = 0
       let flyHeight = (canvas.height / 2) - (birdHeight / 2);
       let pipePos = canvas.width; 
       let pipePos2 = canvas.width + ((canvas.width / 2) + (pipeWidth / 2));
       let pipeYCenter1 = getPipeYCenter1();
       let pipeYCenter2 = getPipeYCenter1();

       function getPipeYCenter1() {
            return (
                 (canvas.height / 2) 
                 - Math.round(Math.random() * pipeYOffset)
                 - pipeHeight
                );
       }

       function loop() {
        // drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight)
            // Background
            ctx.drawImage(img, 
                0, 0, 
                canvas.width, 768, 
                0, 0, 
                canvas.width, canvas.height
            );
           
            // Bird Flight
            if (flapCount < flapDuration) {
                if (flyHeight > 0) {
                    flyHeight -= antiGravity;
                }
                flapCount++;
            }
            
            else if (flyHeight < canvas.height - birdHeight) {
                flyHeight += gravity;
            }
           
            // Bird
            ctx.drawImage(img, 
                canvas.width + 1, 0, 
                birdWidth, birdHeight, 
                birdStartX, flyHeight, 
                birdWidth, birdHeight
            );
            
            if (pipePos > -pipeWidth) {
                pipePos -= pipeSpeed;
            }
            else {
                // Reset Pipe 1
                pipePos = canvas.width;
                pipeYCenter1 = getPipeYCenter1();
            }
            
            // Upper Pipe 1
            ctx.drawImage(img, 
                canvas.width + 1, (birdHeight * 3) + 1, 
                pipeWidth, pipeHeight, 
                pipePos, pipeYCenter1, 
                pipeWidth, pipeHeight
            );

            // Lower Pipe 1
            ctx.drawImage(img, 
                canvas.width + pipeWidth + 1, (birdHeight * 3) + 1, 
                pipeWidth, pipeHeight, 
                pipePos, pipeHeight + pipeGap + pipeYCenter1,
                pipeWidth, pipeHeight
            );

            if (pipePos2 > -pipeWidth) {
                pipePos2 -= pipeSpeed;
            }
            else {
                // Reset Pipe 2
                pipePos2 = canvas.width;
                pipeYCenter2 = getPipeYCenter1();
            }

             // Upper Pipe 2
             ctx.drawImage(img, 
                canvas.width + 1, (birdHeight * 3) + 1, 
                pipeWidth, pipeHeight, 
                pipePos2, pipeYCenter2, 
                pipeWidth, pipeHeight
            );

            // Lower Pipe 2
            ctx.drawImage(img, 
                canvas.width + pipeWidth + 1, (birdHeight * 3) + 1, 
                pipeWidth, pipeHeight, 
                pipePos2, pipeHeight + pipeGap + pipeYCenter2,
                pipeWidth, pipeHeight
            );

            window.requestAnimationFrame(loop);
       }
       
       let ctx = canvas.getContext('2d');
       const img = new Image ();
       img.src = "flappy-bird-set.png";
       img.onload = loop;

       window.onkeydown = function(evt) {
            if (evt.code == "Space")
                if (flyHeight > 0) flapCount = 0;
       }

    </script>
</body>
</html>